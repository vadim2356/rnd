/**
 * Детерминированный выбор вариантов по slug. Контент уникален между страницами.
 */

export function hashSeed(str: string): number {
  let h = 0;
  for (let i = 0; i < str.length; i++) {
    const c = str.charCodeAt(i);
    h = (h << 5) - h + c;
    h = h & h;
  }
  return Math.abs(h);
}

export function pickBySlug<T>(slug: string, variants: T[]): T {
  if (variants.length === 0) throw new Error("pickBySlug: empty variants");
  return variants[hashSeed(slug) % variants.length];
}

/** Только для Ростова: « и области», для остальных городов — пустая строка. */
function regionSuffix(slug: string): string {
  return slug === "rostov-na-donu" ? " и области" : "";
}

export type ContentVars = {
  cityName: string;
  cityNameGenitive: string;
  region: string;
  serviceTitle: string;
  serviceShortDescription: string;
  brandName: string;
  /** Только Ростов: « и области», иначе «». Задаётся на городских страницах. */
  regionSuffix?: string;
  /** Предложный падеж города (в Ростове-на-Дону) — для «Работаем в X». */
  cityNamePrepositional?: string;
  /** Род. падеж региона (по Ростовской области) — для «выезжаем по X». */
  regionGenitive?: string;
};

// ——— A) Hero (3 варианта) ———
const HERO_LEADS = [
  (v: ContentVars) =>
    `Выполняем ${v.serviceTitle.toLowerCase()} в ${v.cityNameGenitive} и ${v.region}. Подбор оборудования по анализу воды, монтаж водоочистки под ключ за один день. Гарантия на работы и оборудование.`,
  (v: ContentVars) =>
    `${v.serviceTitle} в ${v.cityName}${v.regionSuffix !== undefined ? v.regionSuffix : " и области"}: выезд инженера, подбор схемы, установка систем очистки воды под ключ. Работаем с частными домами, квартирами и объектами бизнеса.`,
  (v: ContentVars) =>
    `Монтаж водоочистки в ${v.cityNameGenitive} — ${v.serviceShortDescription} Подбор по анализу, доставка, установка и пусконаладка. ${v.brandName}.`,
];

export function getHeroLead(slug: string, vars: ContentVars): string {
  return pickBySlug(slug, HERO_LEADS)(vars);
}

// ——— B) Лид-абзац (3 варианта) ———
const LEAD_PARAGRAPHS = [
  (v: ContentVars) =>
    `Заказы на ${v.serviceTitle.toLowerCase()} в ${v.cityNameGenitive} принимаем по телефону и через заявку на сайте. Выезжаем в черту города и в прилегающие населённые пункты. Стоимость зависит от схемы очистки и типа оборудования; ориентировочный расчёт даём после уточнения источника воды и при необходимости анализа.`,
  (v: ContentVars) =>
    `В ${v.cityName} и по ${v.region} выполняем монтаж водоочистки: от фильтра под мойку до комплексной установки систем очистки воды для дома или объекта. Срок выполнения — обычно один рабочий день; для сложных объектов оговариваем отдельно.`,
  (v: ContentVars) =>
    `Обращаясь в ${v.brandName}, вы получаете подбор оборудования, доставку и установку под ключ. Работаем в ${v.cityNameGenitive}${v.regionSuffix !== undefined ? v.regionSuffix : " и области"}. Анализ воды рекомендуем при водоснабжении из скважины или колодца — по нему подбираем точную схему и избегаем лишних затрат.`,
];

export function getLeadParagraph(slug: string, vars: ContentVars): string {
  return pickBySlug(slug, LEAD_PARAGRAPHS)(vars);
}

// ——— C) Когда нужна услуга (4 варианта) ———
const WHEN_NEEDED = [
  (v: ContentVars) =>
    `К ${v.serviceTitle.toLowerCase()} в ${v.cityNameGenitive} прибегают, когда вода из скважины или колодца даёт рыжий осадок, запах, оставляет разводы на сантехнике или не подходит для питья. Часто заказывают комплекс: обезжелезивание или умягчение плюс питьевой фильтр. Для центрального водопровода в квартире обычно достаточно умягчителя или обратного осмоса под мойку.`,
  (v: ContentVars) =>
    `Установка систем очистки воды востребована в ${v.cityName}${v.regionSuffix !== undefined ? v.regionSuffix : " и области"} у владельцев частных домов со скважиной, в новостройках с жёсткой водой и у объектов малого бизнеса (кафе, автомойки). Типичные поводы: жёсткость, железо, запах сероводорода, мутность, необходимость получить питьевую воду на кухне.`,
  (v: ContentVars) =>
    `Услугу заказывают при проблемах с качеством воды: накипь в бойлере и чайнике, ржавые подтёки, запах, мутность, желание отказаться от бутилированной воды. В ${v.region} распространены скважины с повышенным железом и жёсткостью — под них подбираем схему по анализу и монтируем под ключ.`,
  (v: ContentVars) =>
    `Монтаж водоочистки в ${v.cityNameGenitive} нужен, когда существующая вода не устраивает по жёсткости, железу, запаху или мутности, либо когда требуется отдельный питьевой фильтр. Мы подбираем оборудование под анализ и бюджет, выполняем установку и пусконаладку, выдаём договор и гарантию.`,
];

export function getWhenNeeded(slug: string, vars: ContentVars): string {
  return pickBySlug(slug, WHEN_NEEDED)(vars);
}

// ——— D) Как проходит монтаж (3 варианта) ———
const HOW_MOUNTING = [
  (v: ContentVars) =>
    `Выезд инженера для осмотра и при необходимости отбора пробы воды. Подбор схемы и оборудования, согласование сметы. В оговорённый день — доставка материалов и оборудования, монтаж и подключение, пусконаладка и проверка. Передаём документы, даём рекомендации по эксплуатации и графику обслуживания. Установка систем очистки воды под ключ в ${v.cityNameGenitive} обычно укладывается в один рабочий день.`,
  (v: ContentVars) =>
    `После заявки согласовываем дату выезда. На объекте оцениваем источник воды, точки разбора и возможности размещения оборудования. Если анализа нет — можем отобрать пробу или подобрать универсальную схему. Монтаж водоочистки выполняем в согласованные сроки; по завершении проводим пусконаладку и обучаем пользованию. Гарантия на работы и оборудование оформляется в договоре.`,
  (v: ContentVars) =>
    `Этапы: консультация и при необходимости анализ воды, подбор оборудования, доставка и монтаж, пусконаладка. В ${v.cityName}${v.regionSuffix !== undefined ? v.regionSuffix : " и области"} выезжаем сами; сложные объекты с несколькими точками разбора могут потребовать два дня — сроки оговариваем при расчёте. По итогу вы получаете работающую систему очистки воды и документы с гарантией.`,
];

export function getHowMounting(slug: string, vars: ContentVars): string {
  return pickBySlug(slug, HOW_MOUNTING)(vars);
}

// ——— E) Что входит — берётся из service.whatIncluded в странице ———

// ——— F) Ценовые пакеты (Эконом / Оптимум / Премиум, без цифр) ———
const PRICE_TIERS_TEMPLATES = [
  () => ({
    econom: "Базовый комплект под типовые показатели воды. Подходит при ограниченном бюджете или для дачи с непостоянным проживанием.",
    optimum: "Сбалансированный вариант: оборудование с запасом по ресурсу, удобная автоматика. Рекомендуем для постоянного проживания в доме или квартире.",
    premium: "Расширенная схема: повышенная производительность, брендовое оборудование, при необходимости автоматика и сервисный договор.",
  }),
  () => ({
    econom: "Минимально необходимый набор для улучшения качества воды. Ориентир на решение одной-двух задач (например, жёсткость или питьевая вода).",
    optimum: "Оптимальное соотношение цены и возможностей. Подбор под анализ воды, запас по ресурсу картриджей и засыпок. Подходит большинству объектов.",
    premium: "Максимальный комфорт и надёжность: производительное оборудование, удобное управление, приоритетное сервисное обслуживание.",
  }),
  () => ({
    econom: "Простая схема под стабильное качество воды. Подходит для квартир и небольших домов с центральным водопроводом или неглубокой скважиной.",
    optimum: "Универсальная схема под анализ воды. Рекомендуем для частных домов со скважиной и несколькими точками разбора. Гарантия и сервис.",
    premium: "Комплексная система с запасом по производительности и автоматикой. Для объектов с высокими требованиями к качеству воды и удобству эксплуатации.",
  }),
];

export function getPriceTiers(slug: string): { econom: string; optimum: string; premium: string } {
  return pickBySlug(slug, PRICE_TIERS_TEMPLATES)();
}

// ——— G) FAQ (динамически по faqCount) ———
const FAQ_QUESTIONS: Array<(v: ContentVars) => string> = [
  (v) => `Сколько стоит ${v.serviceTitle.toLowerCase()} в ${v.cityNamePrepositional ?? (v.cityName === "Ростов-на-Дону" ? "Ростове-на-Дону" : v.cityName)}?`,
  (v) => `За сколько дней выполняете монтаж в ${v.cityNamePrepositional ?? (v.cityName === "Ростов-на-Дону" ? "Ростове-на-Дону" : v.cityName)}?`,
  (v) => `Нужен ли анализ воды перед подбором оборудования?`,
  (v) => `Даёте ли гарантию на монтаж и оборудование?`,
  (v) => `Выезжаете ли в пригороды и сёла ${v.cityNameGenitive}?`,
  (v) => `Что входит в услугу под ключ?`,
  (v) => `Можно ли установить только фильтр под мойку?`,
  (v) => `Обслуживаете установленное оборудование?`,
  (v) => `Как часто нужно менять картриджи или засыпку?`,
  (v) => `Работаете ли с юридическими лицами и по безналу?`,
];

const FAQ_ANSWERS: Array<(v: ContentVars) => string> = [
  (v) =>
    `Стоимость зависит от схемы очистки, производительности и типа оборудования. Ориентировочный расчёт даём после уточнения источника воды и точек разбора; при наличии анализа воды — более точный подбор и смета.`,
  (v) => {
    const cityP = v.cityNamePrepositional ?? (v.cityName === "Ростов-на-Дону" ? "Ростове-на-Дону" : v.cityName);
    return `В большинстве случаев монтаж водоочистки в ${cityP} выполняем за один рабочий день. Сложные объекты с несколькими этажами или нестандартной разводкой могут потребовать два дня.`;
  },
  (v) =>
    `Для скважины и колодца анализ желателен — по нему подбираем точную схему и избегаем переплат. Если анализа нет, можем отобрать пробу при выезде или предложить универсальную схему с запасом. Для центрального водопровода часто достаточно типового решения.`,
  (v) =>
    `Да. На монтажные работы предоставляем гарантию. На оборудование действует гарантия производителя. Условия фиксируем в договоре.`,
  (v) => {
    const cityP = v.cityNamePrepositional ?? (v.cityName === "Ростов-на-Дону" ? "Ростове-на-Дону" : v.cityName);
    const regionP = v.regionGenitive ?? (v.region === "Ростовская область" ? "Ростовской области" : v.region);
    return `Да. Работаем в ${cityP} и выезжаем по ${regionP}: прилегающие районы и населённые пункты в зоне обслуживания. Выезд в пределах зоны без доплат.`;
  },
  (v) =>
    `Выезд инженера, подбор оборудования, доставка, монтаж и подключение, пусконаладка, обучение пользованию. Договор и гарантия. Замена картриджей и сервис — отдельно по желанию.`,
  (v) =>
    `Да. Если нужна только чистая вода на кухне для питья и готовки, подбираем проточный или накопительный фильтр под мойку. Монтаж занимает около часа.`,
  (v) =>
    `Да. Предлагаем сервисное обслуживание: замена картриджей, регенерация засыпок, ремонт. Можно оформить договор на сервис или вызывать по мере необходимости.`,
  (v) =>
    `Зависит от типа фильтра и качества входящей воды. Для картриджей предварительной очистки — обычно раз в 3–6 месяцев; для засыпных фильтров — регенерация по регламенту. Рекомендации даём при сдаче объекта.`,
  (v) =>
    `Да. Работаем с ИП и юрлицами, возможна оплата по счёту и заключение договора. Условия уточняйте по телефону или в заявке.`,
];

export type FAQItem = { question: string; answer: string };

export function getFaq(slug: string, faqCount: number, vars: ContentVars): FAQItem[] {
  const count = Math.min(faqCount, FAQ_QUESTIONS.length);
  const indices: number[] = [];
  for (let i = 0; i < FAQ_QUESTIONS.length; i++) indices.push(i);
  for (let i = indices.length - 1; i > 0; i--) {
    const j = hashSeed(slug + "faq" + i) % (i + 1);
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  const items: FAQItem[] = [];
  for (let i = 0; i < count; i++) {
    const idx = indices[i];
    items.push({
      question: FAQ_QUESTIONS[idx](vars),
      answer: FAQ_ANSWERS[idx](vars),
    });
  }
  return items;
}

// ——— H) Отзывы (3–4, разные формулировки) ———
const REVIEW_TEMPLATES = [
  (v: ContentVars) => ({
    name: "Андрей",
    text: `Заказывал установку систем очистки воды в ${v.cityNameGenitive}. Приехали в срок, смонтировали за день. Вода из скважины теперь без запаха и осадка. Рекомендую.`,
  }),
  (v: ContentVars) => ({
    name: "Ольга",
    text: `Поставили умягчитель и фильтр под мойку. Монтаж водоочистки выполнен аккуратно, всё объяснили. Работают по договору, дали гарантию.`,
  }),
  (v: ContentVars) => ({
    name: "Дмитрий",
    text: `Нужна была очистка воды из скважины — железо и жёсткость. Подобрали схему по анализу, установили под ключ. Доволен результатом и сроками.`,
  }),
  (v: ContentVars) => ({
    name: "Елена",
    text: `Обратилась в ${v.brandName} для дома в области. Выехали, отобрали пробу, предложили вариант под бюджет. Смонтировали за один день. Обслуживание тоже у них.`,
  }),
  (v: ContentVars) => ({
    name: "Сергей",
    text: `Ставили комплекс на скважину: обезжелезивание и умягчение. Работу выполнили качественно, документы и гарантию оформили. Цена соответствовала смете.`,
  }),
  (v: ContentVars) => ({
    name: "Мария",
    text: `Заказывала обратный осмос под мойку в ${v.cityNameGenitive}. Приехали быстро, установили за пару часов. Питьевая вода теперь всегда под рукой. Спасибо.`,
  }),
];

export function getReviews(slug: string, vars: ContentVars): { name: string; text: string }[] {
  const count = 3 + (hashSeed(slug) % 2); // 3 или 4
  const out: { name: string; text: string }[] = [];
  const used = new Set<number>();
  for (let i = 0; i < count; i++) {
    let idx = hashSeed(slug + "rev" + i) % REVIEW_TEMPLATES.length;
    while (used.has(idx)) idx = (idx + 1) % REVIEW_TEMPLATES.length;
    used.add(idx);
    out.push(REVIEW_TEMPLATES[idx](vars));
  }
  return out;
}

// ——— I) Кейсы (для город-хабов) ———
const CASE_TEMPLATES = [
  (cityName: string, citySlug: string) => ({
    title: `Частный дом в ${cityName}, скважина`,
    text: `Подобрали и смонтировали комплекс обезжелезивания и умягчения по анализу воды. Установка систем очистки воды выполнена за один день. Заказчик пользуется системой более года, периодически заказывает обслуживание.`,
  }),
  (cityName: string, citySlug: string) => ({
    title: `Квартира в новостройке, ${cityName}`,
    text: `Установлен умягчитель и фильтр обратного осмоса под мойку. Монтаж водоочистки занял несколько часов. Вода из центрального водопровода после очистки используется для питья и бытовой техники.`,
  }),
  (cityName: string, citySlug: string) => ({
    title: `Дача с колодцем, ${cityName}`,
    text: `Смонтирована схема с аэрацией и обезжелезиванием, на кухне — питьевой фильтр. Очистка воды из скважины и колодца — одно из частых обращений в нашу компанию по области.`,
  }),
  (cityName: string, citySlug: string) => ({
    title: `Небольшой офис, ${cityName}`,
    text: `Под ключ установлена система очистки воды для кухни и санузлов. Подбор по расходу и качеству входящей воды. Договор на сервисное обслуживание по желанию заказчика.`,
  }),
  (cityName: string, citySlug: string) => ({
    title: `Коттедж со скважиной, ${cityName}`,
    text: `Выполнены анализ воды, подбор оборудования и монтаж под ключ. Решены проблемы с железом и жёсткостью. Гарантия на работы и оборудование оформлена в договоре.`,
  }),
];

export function getCases(cityName: string, citySlug: string): { title: string; text: string }[] {
  const count = 3 + (hashSeed(citySlug) % 2); // 3 или 4
  const out: { title: string; text: string }[] = [];
  const used = new Set<number>();
  for (let i = 0; i < count; i++) {
    let idx = hashSeed(citySlug + "case" + i) % CASE_TEMPLATES.length;
    while (used.has(idx)) idx = (idx + 1) % CASE_TEMPLATES.length;
    used.add(idx);
    out.push(CASE_TEMPLATES[idx](cityName, citySlug));
  }
  return out;
}

// ——— Город-хаб: лид и FAQ (P = предложный падеж: в Батайске) ———
const CITY_HUB_LEADS = [
  (cityName: string, region: string, P?: string, slug?: string) => {
    const p = P ?? cityName;
    return `Монтаж водоочистки в ${p} и по ${region}: подбор по анализу воды, установка систем очистки воды под ключ за один день. Работаем с частными домами, квартирами и объектами малого бизнеса. Гарантия на работы и оборудование.`;
  },
  (cityName: string, region: string, P?: string, slug?: string) => {
    const p = P ?? cityName;
    return `Установка систем очистки воды в ${p}${regionSuffix(slug ?? "rostov-na-donu")}. Выезд инженера, подбор схемы под источник воды и бюджет, доставка и монтаж. Обезжелезивание, умягчение, аэрация, обратный осмос, УФ-обеззараживание, сервис.`;
  },
  (cityName: string, region: string, P?: string, slug?: string) => {
    const p = P ?? cityName;
    return `В ${p} выполняем полный цикл: от анализа воды до сдачи системы под ключ. Очистка воды из скважины, колодца и центрального водопровода. Работаем по городу и прилегающим населённым пунктам ${region}.`;
  },
];

export function getCityHubLead(cityName: string, citySlug: string, cityNamePrepositional?: string): string {
  return pickBySlug(citySlug, CITY_HUB_LEADS)(cityName, "Ростовская область", cityNamePrepositional, citySlug);
}

const CITY_WATER_FEATURES = [
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `В ${region} вода часто подаётся из скважин и поверхностных источников. Типичные проблемы: повышенное железо, жёсткость, мутность, запах сероводорода. В ${p} и пригородах состав воды различается по районам — поэтому перед подбором оборудования рекомендуем анализ или отбор пробы при выезде. По результатам подбираем схему очистки: обезжелезивание, умягчение, аэрация, обратный осмос или комплекс под ключ.`;
  },
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `Качество воды в ${p} и по ${region} зависит от источника: скважина, колодец или центральный водопровод. В частном секторе нередки жёсткость и железо; в новостройках — хлор и повышенная жёсткость. Мы выезжаем на объект, при необходимости отбираем пробу и подбираем оборудование под ваши показатели. Монтаж водоочистки выполняем за один день в большинстве случаев.`;
  },
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `Особенности воды в ${p}: в разных микрорайонах и пригородах состав может отличаться. Где-то преобладает железо и марганец, где-то — жёсткость и мутность. Очистка воды из скважины востребована в частном секторе; в квартирах чаще заказывают умягчение и фильтры под мойку. Подбор по анализу позволяет не переплачивать и получить стабильный результат. Установка систем очистки воды под ключ — наш основной формат работы.`;
  },
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `В ${p} и по ${region} распространены скважины с повышенным содержанием железа и жёсткости. Центральный водопровод в городе обычно соответствует нормативам, но жёсткость и запах хлора нередко остаются. Мы подбираем схему под источник и задачи: от питьевого фильтра под мойку до комплексной системы для дома со скважиной. Монтаж за один день, гарантия на работы и оборудование.`;
  },
];

export function getCityWaterFeatures(cityName: string, citySlug: string, cityNamePrepositional?: string): string {
  return pickBySlug(citySlug, CITY_WATER_FEATURES)(cityName, "Ростовской области", cityNamePrepositional);
}

const CITY_HOW_WE_WORK = [
  (cityName: string, P?: string) => {
    const p = P ?? cityName;
    return `Как мы работаем в ${p}: приём заявки по телефону или через сайт, согласование даты выезда. На объекте оцениваем источник воды, точки разбора и пожелания по бюджету. При необходимости отбираем пробу для анализа. Подбираем схему и оборудование, согласовываем смету. В оговорённый день привозим материалы, монтируем и подключаем систему, проводим пусконаладку и обучаем пользованию. Передаём документы и гарантию. Срок — обычно один рабочий день.`;
  },
  (cityName: string, P?: string) => {
    const p = P ?? cityName;
    return `В ${p} порядок такой: заявка → выезд инженера (при необходимости с отбором пробы) → подбор оборудования и расчёт → доставка и монтаж → пусконаладка и обучение. Работаем с частными домами, квартирами и малым бизнесом. Установка систем очистки воды под ключ означает, что вы получаете готовую работающую систему и документы; замену картриджей и сервис можно заказывать отдельно. Выезд в пригороды и соседние населённые пункты — в зоне обслуживания.`;
  },
  (cityName: string, P?: string, slug?: string) => {
    const p = P ?? cityName;
    return `Работа в ${p}${regionSuffix(slug ?? "rostov-na-donu")}: вы оставляете заявку, мы связываемся и назначаем выезд. Инженер осматривает объект, уточняет источник воды и при необходимости отбирает пробу. Далее — подбор схемы, смета и согласование. Монтаж водоочистки выполняем в удобный вам день; по завершении проводим пусконаладку и выдаём гарантию. Сложные объекты с несколькими этажами могут потребовать два дня — сроки оговариваем заранее. Оборудование и работы оформляем по договору.`;
  },
  (cityName: string, P?: string) => {
    const p = P ?? cityName;
    return `Как мы работаем в ${p}: от заявки до сдачи под ключ. Принимаем заявки по телефону и с сайта, выезжаем в черту города и в прилегающие населённые пункты. На объекте определяем состав воды (или опираемся на имеющийся анализ), подбираем оборудование и составляем смету. Доставка, монтаж и пусконаладка — в один день в типовых случаях. По итогу — работающая система очистки воды, договор и гарантия. Сервисное обслуживание и замена картриджей — по желанию.`;
  },
];

export function getCityHowWeWork(cityName: string, citySlug: string, cityNamePrepositional?: string): string {
  return pickBySlug(citySlug, CITY_HOW_WE_WORK)(cityName, cityNamePrepositional, citySlug);
}

const CITY_HUB_FAQ_Q = [
  (cityName: string, P?: string) => `Сколько стоит установка системы очистки воды в ${P ?? cityName}?`,
  (cityName: string, P?: string) => `Выезжаете ли в пригороды ${P ?? cityName}?`,
  (cityName: string, P?: string) => `За сколько дней монтируете в ${P ?? cityName}?`,
  (cityName: string) => `Нужен ли анализ воды перед монтажом?`,
  (cityName: string, P?: string) => `Какие услуги водоочистки доступны в ${P ?? cityName}?`,
  (cityName: string) => `Даёте ли гарантию на монтаж?`,
  (cityName: string, P?: string) => `Работаете ли с юридическими лицами в ${P ?? cityName}?`,
  (cityName: string, P?: string) => `Можно ли заказать только обслуживание оборудования в ${P ?? cityName}?`,
];

const CITY_HUB_FAQ_A = [
  () =>
    `Стоимость зависит от схемы очистки и типа оборудования. Базовые решения — от ориентировочной суммы под ключ; точный расчёт после выезда и при необходимости анализа воды.`,
  () =>
    `Да. Работаем в черте города и выезжаем в прилегающие населённые пункты Ростовской области. Выезд в зоне обслуживания без доплат.`,
  (cityName: string, P?: string, slug?: string) =>
    `В большинстве случаев монтаж в ${P ?? cityName}${regionSuffix(slug ?? "rostov-na-donu")} выполняем за один рабочий день. Сложные объекты могут потребовать два дня — сроки оговариваем при расчёте.`,
  () =>
    `Для скважины и колодца анализ желателен — по нему подбираем точную схему. Если анализа нет, можем отобрать пробу при выезде или предложить универсальную схему.`,
  () =>
    `Установка систем очистки воды, умягчение, обезжелезивание, аэрация, обратный осмос, УФ-обеззараживание, обслуживание. Перечень услуг и цены уточняйте по телефону или на страницах услуг по городу.`,
  () =>
    `Да. На монтажные работы предоставляем гарантию. На оборудование действует гарантия производителя. Условия в договоре.`,
  () =>
    `Да. Работаем с ИП и юридическими лицами, возможна оплата по счёту и заключение договора. Условия уточняйте по телефону или в заявке.`,
  (cityName: string, P?: string) =>
    `Да. Предлагаем сервисное обслуживание: замена картриджей, регенерация засыпок, ремонт. Можно оформить договор на сервис или вызывать по мере необходимости. В ${P ?? cityName} выезжаем в зоне обслуживания.`,
];

export function getCityHubFaq(cityName: string, citySlug: string, cityNamePrepositional?: string): FAQItem[] {
  const P = cityNamePrepositional ?? cityName;
  const count = Math.min(6 + (hashSeed(citySlug) % 3), CITY_HUB_FAQ_Q.length);
  const indices: number[] = [];
  for (let i = 0; i < CITY_HUB_FAQ_Q.length; i++) indices.push(i);
  for (let i = indices.length - 1; i > 0; i--) {
    const j = hashSeed(citySlug + String(i)) % (i + 1);
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  const items: FAQItem[] = [];
  for (let i = 0; i < count; i++) {
    const idx = indices[i];
    items.push({
      question: CITY_HUB_FAQ_Q[idx](cityName, P),
      answer: CITY_HUB_FAQ_A[idx](cityName, P, citySlug),
    });
  }
  return items;
}

// ——— Индексные страницы: SEO-текст и FAQ ———
const SERVICES_INDEX_SECTIONS = [
  {
    h2: "Установка и обслуживание систем очистки воды",
    text: "Мы выполняем монтаж водоочистки в Ростове-на-Дону и Ростовской области: от фильтра под мойку до комплексной системы для дома со скважиной. Подбор оборудования ведём по анализу воды и бюджету заказчика. В перечень услуг входят умягчение воды, обезжелезивание, аэрация, обратный осмос, УФ-обеззараживание, а также сервисное обслуживание и замена картриджей. Работаем с частными домами, квартирами и объектами малого бизнеса. Установка систем очистки воды под ключ обычно выполняется за один рабочий день; гарантия на работы и оборудование оформляется в договоре.",
  },
  {
    h2: "Как подобрать схему очистки",
    text: "Для скважины и колодца рекомендуем анализ воды — по нему подбираем точную схему и избегаем переплат. Если анализа нет, инженер может отобрать пробу при выезде. Для центрального водопровода в квартире часто достаточно типового решения: умягчитель или фильтр обратного осмоса под мойку. На страницах услуг по городам вы найдёте детальное описание каждой услуги и ориентиры по срокам. Стоимость зависит от типа оборудования и сложности монтажа; точный расчёт даём после осмотра объекта.",
  },
];

const SERVICES_INDEX_FAQ: FAQItem[] = [
  {
    question: "Какие услуги по водоочистке вы оказываете?",
    answer:
      "Установка систем очистки воды под ключ, умягчение, обезжелезивание, аэрация, обратный осмос, УФ-обеззараживание, обслуживание и замена картриджей. Полный перечень с описанием — на этой странице и на страницах по каждой услуге.",
  },
  {
    question: "В какие города выезжаете?",
    answer:
      "Работаем в Ростове-на-Дону и выезжаем по Ростовской области: Батайск, Аксай, Азов, Таганрог, Новочеркасск, Шахты, Новошахтинск, Каменск-Шахтинский, Волгодонск и прилегающие районы. Список городов и услуг по каждому городу — в разделе «Города».",
  },
];

export function getServicesIndexContent(): { sections: { h2: string; text: string }[]; faq: FAQItem[] } {
  return { sections: SERVICES_INDEX_SECTIONS, faq: SERVICES_INDEX_FAQ };
}

const SOLUTIONS_INDEX_SECTIONS = [
  {
    h2: "Решения по типу объекта и источнику воды",
    text: "Подбираем схему водоочистки под ваш объект: частный дом, квартира, дача со скважиной или бизнес (кафе, отель, кофейня). Для частного дома со скважиной обычно нужны обезжелезивание и умягчение; для квартиры — умягчитель или фильтр под мойку. Очистка воды из скважины — одна из самых востребованных задач в Ростовской области: состав воды по районам различается, поэтому рекомендуем анализ перед подбором оборудования. Монтаж под ключ выполняем за один день в большинстве случаев.",
  },
  {
    h2: "Источники воды и типовые схемы",
    text: "Работаем с водой из скважины, колодца и центрального водопровода. Для скважины типичны схемы с аэрацией, обезжелезиванием и умягчением; для квартиры — компактные умягчители и обратный осмос под мойку. Для бизнеса и HoReCa подбираем оборудование под нагрузку и требования к качеству воды. Подробнее — на страницах решений и на главной странице, где можно оставить заявку на расчёт.",
  },
];

const SOLUTIONS_INDEX_FAQ: FAQItem[] = [
  {
    question: "Чем отличаются решения для дома и для квартиры?",
    answer:
      "Для частного дома со скважиной обычно нужна комплексная система: обезжелезивание, умягчение, при необходимости аэрация и УФ. Для квартиры с центральным водопроводом — чаще умягчитель и/или фильтр под мойку (обратный осмос). Подбор зависит от анализа воды и количества точек разбора.",
  },
  {
    question: "Делаете ли вы водоочистку для бизнеса?",
    answer:
      "Да. Подбираем и монтируем системы для кафе, ресторанов, отелей, кофеен: кухня, кофемашины, льдогенераторы. Работаем с ИП и юрлицами, возможна оплата по счёту. Условия уточняйте по телефону или в заявке.",
  },
];

export function getSolutionsIndexContent(): { sections: { h2: string; text: string }[]; faq: FAQItem[] } {
  return { sections: SOLUTIONS_INDEX_SECTIONS, faq: SOLUTIONS_INDEX_FAQ };
}

const GORODA_INDEX_SECTIONS = [
  {
    h2: "Выезд и монтаж по Ростовской области",
    text: "Мы выполняем установку систем очистки воды не только в Ростове-на-Дону, но и в городах области: Батайск, Аксай, Азов, Таганрог, Новочеркасск, Шахты, Новошахтинск, Каменск-Шахтинский, Волгодонск. В каждом городе доступны те же услуги: умягчение, обезжелезивание, аэрация, обратный осмос, УФ-обеззараживание, обслуживание. Монтаж водоочистки под ключ выполняем за один день в типовых случаях; выезд в пределах зоны обслуживания без доплат.",
  },
  {
    h2: "Как заказать услугу в вашем городе",
    text: "Оставьте заявку на сайте или позвоните по телефону — согласуем дату выезда. Инженер приедет на объект, при необходимости отберёт пробу воды и подберёт схему очистки. На странице каждого города перечислены услуги и ссылки на подробные страницы «услуга + город». Ориентировочные цены и сроки можно уточнить по телефону или на странице «Цены».",
  },
];

const GORODA_INDEX_FAQ: FAQItem[] = [
  {
    question: "Выезжаете ли вы в сёла и пригороды?",
    answer:
      "Да. Работаем в черте перечисленных городов и выезжаем в прилегающие населённые пункты Ростовской области. Выезд в зоне обслуживания без доплат. Точные границы зоны уточняйте по телефону.",
  },
  {
    question: "Сколько стоит установка в другом городе?",
    answer:
      "Стоимость зависит от схемы очистки и типа оборудования, а не от города. Выезд в пределах зоны обслуживания не тарифицируется отдельно. Ориентировочные цены — на странице «Цены»; точный расчёт после выезда инженера.",
  },
];

export function getGorodaIndexContent(): { sections: { h2: string; text: string }[]; faq: FAQItem[] } {
  return { sections: GORODA_INDEX_SECTIONS, faq: GORODA_INDEX_FAQ };
}

const PRICES_LEADS = [
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `Ориентировочные цены на установку систем очистки воды в ${p} и ${region}. Стоимость зависит от схемы очистки, типа оборудования и сложности монтажа. Точный расчёт даём после выезда инженера и при необходимости анализа воды.`;
  },
  (cityName: string, region: string, P?: string) => {
    const p = P ?? cityName;
    return `Сколько стоит монтаж водоочистки в ${p}? Ниже — ценовые пакеты и факторы, влияющие на итоговую сумму. Базовые решения под ключ — от ориентировочной стоимости; для точного расчёта оставьте заявку или позвоните. Работаем по ${region}.`;
  },
  (cityName: string, region: string, P?: string, slug?: string) => {
    const p = P ?? cityName;
    return `Цены на установку систем очистки воды под ключ в ${p}${regionSuffix(slug ?? "rostov-na-donu")}. Три варианта комплектации — Эконом, Оптимум и Премиум; итоговая стоимость зависит от качества воды и количества точек разбора. Подбор по анализу — бесплатно при заказе монтажа.`;
  },
];

const PRICES_LEAD_MAIN =
  "Ориентировочные цены на установку систем очистки воды в Ростове-на-Дону и Ростовской области. Стоимость зависит от схемы очистки, типа оборудования и сложности монтажа. Точный расчёт даём после выезда инженера и при необходимости анализа воды.";

export function getPricesLead(cityName: string, citySlug: string, cityNamePrepositional?: string): string {
  return pickBySlug(citySlug, PRICES_LEADS)(cityName, "Ростовской области", cityNamePrepositional, citySlug);
}

export function getPricesLeadMain(): string {
  return PRICES_LEAD_MAIN;
}

const PRICES_TIERS = [
  () => ({
    econom: "Базовый комплект: фильтр механической очистки, умягчитель или обезжелезиватель под типовые показатели. Подходит для ограниченного бюджета или дачи.",
    optimum: "Сбалансированный вариант: оборудование с запасом по ресурсу, автоматика. Рекомендуем для постоянного проживания в доме или квартире.",
    premium: "Расширенная схема: производительное оборудование, брендовые компоненты, при необходимости сервисный договор. Максимальный комфорт и надёжность.",
  }),
  () => ({
    econom: "Минимальный набор для улучшения качества воды. Решение одной-двух задач: например, жёсткость или питьевая вода под мойку.",
    optimum: "Оптимальное соотношение цены и возможностей. Подбор под анализ воды, запас по ресурсу. Подходит большинству объектов.",
    premium: "Комплексная система с запасом по производительности. Для объектов с высокими требованиями к качеству воды и удобству эксплуатации.",
  }),
];

export function getPricesTiers(seedKey: string): { econom: string; optimum: string; premium: string } {
  return pickBySlug(seedKey, PRICES_TIERS)();
}

// ——— Типы систем (для страницы /prices и /[citySlug]/prices) ———
export interface PriceSystemType {
  title: string;
  priceFrom: number;
  priceLabel: string;
  description: string;
  types: string[];
  varieties: string[];
  /** Опционально: путь к фото карточки (например /images/prices/ro-300.jpg) */
  image?: string;
  /** Опционально: принцип работы (для RO-300 и др.) */
  principleWork?: string[];
  /** Опционально: основные характеристики */
  characteristics?: string[];
  /** Опционально: преимущества */
  advantages?: string[];
  /** Опционально: где применяется (подзаголовки + текст) */
  applications?: { subtitle: string; text: string }[];
  /** Опционально: комплектация */
  equipment?: string[];
  /** Опционально: доп. опции комплектации */
  equipmentOptional?: string[];
  /** Опционально: монтаж и запуск (текст) */
  mountingLaunch?: string;
  /** Опционально: обслуживание (текст) */
  servicing?: string;
  /** Опционально: FAQ внутри карточки */
  faq?: { question: string; answer: string }[];
}

export const PRICES_SYSTEM_TYPES: PriceSystemType[] = [
  {
    title: "Система умягчения воды",
    priceFrom: 15900,
    priceLabel: "от 15 900 ₽",
    image: "/images/prices/soft-1252.jpg",
    description:
      "Автоматический фильтр умягчения воды DS-SOFT-1252 — решение для домов, квартир и коммерческих объектов, где требуется снижение жёсткости воды до комфортных уровней. Система эффективно борется с избыточным содержанием кальция и магния, предотвращает образование накипи и защищает бытовую технику от преждевременного износа. Компактный интегрированный блок с цифровым управлением обеспечивает автоматическую работу без ручного вмешательства и подходит для постоянной эксплуатации.",
    types: [
      "Кабинетные умягчители — под мойку, малая производительность, для питьевой воды и одной точки.",
      "Колонные умягчители — на весь дом или квартиру, с автоматической регенерацией солевым раствором.",
      "Цифровой контроллер — точная настройка и автономная регенерация по таймеру или счётчику объёма.",
      "Для квартиры, частного дома и малого бизнеса — разная производительность и габариты.",
    ],
    varieties: ["автоматический", "цифровое управление", "квартира", "дом", "малый бизнес", "скважина", "водопровод"],
    principleWork: [
      "Вода проходит через слой ионообменной загрузки",
      "Ионы кальция и магния заменяются на безопасные ионы натрия",
      "Твёрдость воды значительно снижается",
      "Автоматическая регенерация и промывка без участия пользователя",
    ],
    characteristics: [
      "Тип: автоматический умягчитель",
      "Управление: цифровой контроллер",
      "Производительность: подходит для дома/квартиры",
      "Источник воды: центральное водоснабжение, скважина",
      "Этап очистки: умягчение",
      "Регулируемая жёсткость на выходе",
      "Автономная регенерация по таймеру или счётчику объёма",
    ],
    advantages: [
      "Полностью автоматическая работа",
      "Цифровое управление и точная настройка",
      "Защита техники от накипи",
      "Снижение расхода моющих средств",
      "Удобство без ручных настроек",
      "Компактный модуль под стандартные условия",
    ],
    applications: [
      { subtitle: "В частном доме", text: "Для защиты котельного оборудования, стиральных/посудомоечных машин, душевых систем." },
      { subtitle: "В квартире", text: "Для улучшения качества воды на всей разводке квартиры." },
      { subtitle: "В объектах малого бизнеса", text: "Там, где требуется стабильное снижение жёсткости воды." },
    ],
    equipment: [
      "Корпус с цифровым контроллером",
      "Ионообменная смола",
      "Насосный модуль (если предусмотрен конфигурацией)",
      "Клапаны и внутренние фильтры",
      "Монтажные элементы",
    ],
    equipmentOptional: [
      "Накопительная ёмкость",
      "Предшествующая механическая фильтрация",
    ],
    mountingLaunch:
      "Мы оказываем полный комплекс услуг: анализ воды, подбор оптимальной конфигурации, поставка оборудования, установка на объекте, настройка цифрового контроллера, пусконаладка и клиентский инструктаж. Работаем в Ростове-на-Дону и Ростовской области.",
    servicing:
      "Для корректной работы рекомендуется: периодическая проверка давления, замена предфильтров раз в 3–6 месяцев, проверка состояния смолы при высокой жёсткости. График обслуживания предоставляется после установки.",
    faq: [
      { question: "Как часто происходит регенерация?", answer: "Автоматически — по счётчику объёма или по таймеру, в зависимости от настроек контроллера." },
      { question: "Умягчитель подходит для скважинной воды?", answer: "Да, но при высокой мутности рекомендуется предварительная механическая фильтрация." },
      { question: "Можно ли настроить уровень мягкости?", answer: "Да — цифровой контроллер позволяет регулировать выходной уровень жесткости." },
    ],
  },
  {
    title: "Комплексная система очистки воды",
    priceFrom: 28900,
    priceLabel: "от 28 900 ₽",
    image: "/images/prices/complex-1252.jpg",
    description:
      "Комплексная система очистки воды DS-COMPLEX-1252 — оптимальное решение для загородных домов, дач и коттеджей с источниками воды из скважин или колодцев. Установка объединяет в себе умягчитель и окислительно-сорбционный блок, что обеспечивает: устранение жёсткости; удаление растворённого железа; снижение содержания марганца; устранение неприятных запахов; ясную, прозрачную, безопасную воду для бытовых нужд. Такое решение идеально подходит для частных объектов, где требуется комплексное улучшение качества воды без монтажа нескольких отдельных систем.",
    types: [
      "Умягчение — ионообменная смола снижает кальций и магний, защита от накипи.",
      "Окисление и сорбция — удаление железа, марганца, запаха сероводорода, сорбенты последнего поколения.",
      "Стационарный монтаж, автоматическое управление при необходимости.",
      "Для скважины, колодца, централизованной сети с повышенной жёсткостью/железом.",
    ],
    varieties: ["умягчение", "обезжелезивание", "скважина", "колодец", "дача", "коттедж", "2 в 1"],
    principleWork: [
      "1. Умягчение — жёсткая вода проходит через ионообменную смолу, которая снижает концентрацию кальция и магния (основные причины накипи, повреждений котельного оборудования, засоров бытовой техники и повышенного расхода моющих средств).",
      "2. Окисление и сорбция — второй блок устраняет растворённое железо, марганец и другие окисляемые примеси, снижает интенсивность возможного запаха сероводорода. Максимальная прозрачность и эстетика воды достигаются благодаря сорбентам последнего поколения.",
    ],
    characteristics: [
      "Тип: комбинированная система",
      "Производительность: рассчитана для дома/дачи",
      "Источник воды: скважина, колодец, централизованная сеть с повышенной жёсткостью/железом",
      "Этапы очистки: умягчение воды; окисление и удаление растворённого железа",
      "Монтаж: стационарный",
      "Управление: автоматическое (при необходимости)",
    ],
    advantages: [
      "Комплексное решение «2 в 1»",
      "Защита бытовой техники и сантехники от накипи",
      "Удаление железа и марганца",
      "Повышение прозрачности и качества воды",
      "Удобство в эксплуатации",
      "Подходит под частный дом/дачу",
    ],
    applications: [
      { subtitle: "Частный дом", text: "Для защиты котла, стиральной и посудомоечной техники, предотвращения накипи и неприятных вкусов." },
      { subtitle: "Дача", text: "Комплексная очистка воды для кухни, душа и хозяйственных нужд без переоснащения." },
    ],
    equipment: [
      "Емкость с ионообменной смолой для умягчения",
      "Блок окисления и сорбции",
      "Трубная обвязка",
      "Клапаны управления",
      "Монтажные крепления",
    ],
    equipmentOptional: [
      "Бак аккумулирования",
      "УФ-обеззараживание",
      "Автоматическая промывка",
    ],
  },
  {
    title: "Система обратного осмоса на весь дом",
    priceFrom: 98000,
    priceLabel: "от 98 000 ₽",
    image: "/images/prices/ro-300.jpg",
    description:
      "Промышленная система обратного осмоса RO-300 предназначена для глубокой очистки воды от солей жёсткости, растворённого железа, марганца, органических соединений, бактерий и других примесей. Мембранная установка обеспечивает стабильную производительность до 300 литров в час и подходит для коммерческого и производственного применения. Система используется в кафе и ресторанах, пищевом производстве, медицинских учреждениях, лабораториях, коттеджных посёлках, на предприятиях малого и среднего бизнеса. Обратный осмос обеспечивает удаление до 95–99% растворённых солей и позволяет получить воду, соответствующую высоким стандартам качества.",
    types: [
      "С накопительной ёмкостью — стабильный напор и запас чистой воды при низком давлении.",
      "С помпой повышения давления — стабильная работа осмоса при недостаточном давлении в системе.",
      "Многоступенчатая предподготовка — механический фильтр, уголь, умягчение перед мембраной для долгого срока службы.",
      "Блок химической промывки мембран — опционально для сервиса и продления срока службы.",
    ],
    varieties: ["300 л/ч", "кафе", "ресторан", "производство", "медицина", "лаборатория", "коттедж", "гостиница", "накопительная ёмкость", "автопромывка"],
    principleWork: [
      "Предварительная механическая очистка",
      "Удаление хлора и органики",
      "Мембранная фильтрация под давлением",
      "Разделение воды на очищенную (пермеат) и концентрат",
    ],
    characteristics: [
      "Производительность: до 300 л/час",
      "Степень очистки: до 99% растворённых солей",
      "Рабочее давление: от 3–6 бар (в зависимости от конфигурации)",
      "Тип мембран: промышленного класса",
      "Материал рамы: антикоррозийная сталь",
      "Автоматическая защита от сухого хода",
      "Возможность подключения накопительной ёмкости",
    ],
    advantages: [
      "Высокая производительность",
      "Компактное размещение",
      "Автоматическая работа",
      "Низкое энергопотребление",
      "Простое обслуживание",
      "Подходит для непрерывной эксплуатации",
    ],
    applications: [
      { subtitle: "Для кафе и ресторанов", text: "Получение стабильной по качеству воды для приготовления напитков и блюд." },
      { subtitle: "Для производства", text: "Подготовка воды для технологических процессов." },
      { subtitle: "Для частных объектов", text: "Обеспечение чистой питьевой воды в коттеджах и гостиницах." },
    ],
    equipment: [
      "Мембранный модуль",
      "Насос высокого давления",
      "Предфильтрация",
      "Манометры контроля давления",
      "Клапаны регулировки",
      "Рама и крепления",
    ],
    equipmentOptional: [
      "Накопительная ёмкость",
      "Автоматическая промывка",
    ],
  },
];

export function getPricesSystemTypes(): PriceSystemType[] {
  return PRICES_SYSTEM_TYPES;
}

const PRICES_WHAT_AFFECTS = [
  () =>
    "На итоговую стоимость влияют: источник воды (скважина, колодец, центральный водопровод), состав воды по анализу, количество точек водоразбора, этажность объекта, необходимость питьевого фильтра под мойку. Доставка и выезд в зоне обслуживания входят в расчёт. Замена картриджей и сервис — отдельно по желанию.",
  () =>
    "Стоимость складывается из типа оборудования (механика, умягчение, обезжелезивание, аэрация, УФ, обратный осмос), производительности, бренда и сложности монтажа. Анализ воды позволяет подобрать схему без лишних затрат. Выезд инженера, доставка и монтаж в пределах зоны обслуживания учитываются в смете.",
  () =>
    "Факторы, влияющие на цену: качество входящей воды, требуемая производительность, количество санузлов и точек разбора, необходимость автоматики и сервисного договора. Подбор по анализу — при заказе монтажа бесплатно. Ориентировочные пакеты — Эконом, Оптимум, Премиум; точный расчёт после осмотра объекта.",
];

export function getPricesWhatAffects(seedKey: string): string {
  return pickBySlug(seedKey, PRICES_WHAT_AFFECTS)();
}

const PRICES_FAQ_Q = [
  (cityName: string, P?: string) => `Сколько стоит установка системы очистки воды в ${P ?? cityName}?`,
  () => `Что входит в цену под ключ?`,
  () => `Почему нет точных цен на сайте?`,
  () => `Есть ли доплата за выезд в область?`,
];

const PRICES_FAQ_A = [
  (cityName: string, P?: string) =>
    `Стоимость зависит от схемы очистки и типа оборудования. Базовые решения — от ориентировочной суммы под ключ; точный расчёт после выезда инженера и при необходимости анализа воды. Оставьте заявку или позвоните — подготовим расчёт.`,
  () =>
    `Выезд инженера, подбор оборудования, доставка, монтаж и подключение, пусконаладка, обучение пользованию. Договор и гарантия на работы и оборудование. Замена картриджей и сервис — отдельно по желанию.`,
  () =>
    `Состав воды и условия на объекте у всех разные. Без выезда и при необходимости анализа нельзя назвать точную цену. Мы даём ориентиры по типам систем (умягчение, комплексная очистка от железа и марганца, обратный осмос на весь дом) и делаем точный расчёт после осмотра.`,
  () =>
    `Выезд в пределах зоны обслуживания (Ростов-на-Дону и города области) не тарифицируется отдельно. Стоимость заложена в смету под ключ. Удалённые объекты оговариваются индивидуально.`,
];

export function getPricesFaq(cityName: string, citySlug: string, cityNamePrepositional?: string): FAQItem[] {
  const P = cityNamePrepositional ?? cityName;
  return [
    { question: PRICES_FAQ_Q[0](cityName, P), answer: PRICES_FAQ_A[0](cityName, P) },
    { question: PRICES_FAQ_Q[1](), answer: PRICES_FAQ_A[1]() },
    { question: PRICES_FAQ_Q[2](), answer: PRICES_FAQ_A[2]() },
    { question: PRICES_FAQ_Q[3](), answer: PRICES_FAQ_A[3]() },
  ];
}
